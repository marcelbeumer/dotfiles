#!/bin/bash

# --------------

in_within_vm() {
    echo "TODO: if within vm"
}

in_within_host() {
    echo "TODO: if within host"
}

in_pull() {
    echo "TODO: pull all repos";
}

in_rebuild() {
    echo "TODO: ant, assets, ..."
}

in_refresh() {
    echo "TODO: ant (in/oms/solr), clear caches, rebuild,restart_servers"
}

in_full_update() {
    in_pull && in_refresh
}

in_restart_all() {
    echo "TODO:"
}

in_watch() {
    echo "TODO:"
}

# --------------

cd_in_oms() {
    cd /code/in-oms;
}

cd_in() {
    cd /code/in;
}

app_console() {
    cd_in
    php app-new/console $@
}

single_buster_test() {
    cd_in
    buster-test --config static/javascript/test/buster.js --reporter specification -t static/javascript/test/$1_test.js
}

rebuild_frontend() {
    cd_in
    php app-new/console assets:install static && php app-new/console assetic:dump .
}

watch_frontend() {
    cd_in
    php app-new/console assetic:dump . --force --watch
}

restart_servers() {
    # /etc/init.d/redis-server restart
    /etc/init.d/memcached restart
    /etc/init.d/nginx restart
    /etc/init.d/tomcat6 restart
    /etc/init.d/php5-fpm restart
}

tail_php_log() {
    tail -f /var/log/php.log
}

fix_in_caches() {
    $(cd_in; chmod -R 777 app-new/cache/dev; chmod -R 777 cache);
}

clear_magento_cache() {
    cd_in_oms;
    php magerun.phar cache:clean && php magerun.phar cache:flush && rm /tmp/wsdl-*
}
